<!DOCTYPE html>
<html lang="tr">
<head>

<meta charset="UTF-8">
<title>Neurovision AI — Anatomical Brain Analysis</title>

<style>

body {
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    margin-top: 40px;
}

button {
    padding: 12px 24px;
    font-size: 18px;
    margin-top: 15px;
    cursor: pointer;
}

img {
    margin-top: 25px;
    max-width: 80%;
    border: 2px solid #444;
}

#error {
    color: red;
    margin-top: 15px;
    font-size: 16px;
}

#status {
    margin-top: 15px;
    color: #00ffcc;
    font-size: 18px;
}

</style>

</head>

<body>

<h1>Neurovision AI — MRI Anatomical Brain</h1>

<input type="file" id="file" accept="image/*">

<br>

<button id="analyzeBtn" onclick="analyze()">Analyze</button>

<div id="status"></div>
<div id="error"></div>

<img id="brain">

<script>

async function analyze() {

    const fileInput = document.getElementById("file");
    const errorBox = document.getElementById("error");
    const statusBox = document.getElementById("status");
    const brainImg = document.getElementById("brain");
    const button = document.getElementById("analyzeBtn");

    errorBox.innerText = "";
    brainImg.src = "";

    if (fileInput.files.length === 0) {
        errorBox.innerText = "Lütfen bir görüntü seç.";
        return;
    }

    statusBox.innerText = "Analyzing...";
    button.disabled = true;

    const form = new FormData();
    form.append("image", fileInput.files[0]);

    try {

        const controller = new AbortController();

        // 120 saniye timeout
        const timeout = setTimeout(() => {
            controller.abort();
        }, 120000);

        const res = await fetch("/analyze", {
            method: "POST",
            body: form,
            signal: controller.signal
        });

        clearTimeout(timeout);

        if (!res.ok) {
            throw new Error("Server error: " + res.status);
        }

        const data = await res.json();

        if (!data.success) {
            throw new Error(data.error || "Analiz başarısız");
        }

        // cache bypass
        brainImg.src = data.brain_image + "?t=" + Date.now();

        statusBox.innerText = "Analysis complete";

    }
    catch (err) {

        console.error(err);

        if (err.name === "AbortError") {
            errorBox.innerText = "Timeout: Analiz çok uzun sürdü.";
        }
        else {
            errorBox.innerText = err.message;
        }

        statusBox.innerText = "";

    }
    finally {

        button.disabled = false;

    }

}

</script>

</body>
</html>